diff --git a/index.html b/index.html
index fa9dbdc..5f839a9 100644
--- a/index.html
+++ b/index.html
@@ -111,20 +111,38 @@
             position: relative;
             border: 2px solid #c7d2fe;
             border-radius: 12px;
-            background: white;
             overflow: hidden;
             width: 100%;
-            max-width: 600px;
+            max-width: 1000px;
             aspect-ratio: 3 / 2; /* Match canvas 600x400 */
             margin: 0 auto;
         }
 
+        .canvas-container::before {
+            content: '';
+            position: absolute;
+            top: 0;
+            left: 0;
+            width: 100%;
+            height: 100%;
+            background: white;
+            z-index: 0;
+        }
+
         #drawingCanvas {
             display: block;
             width: 100%;
             height: 100%;
             cursor: crosshair;
             touch-action: none;
+            position: absolute;
+            top: 0;
+            left: 0;
+            z-index: 2 !important;
+        }
+
+        #guideCanvas {
+            z-index: 1 !important;
         }
 
         .drawing-controls {
@@ -407,7 +425,7 @@
             background: #f9fafb;
             border-radius: 12px;
             width: 100%;
-            max-width: 600px;
+            max-width: 1000px;
             aspect-ratio: 3 / 2; /* Match drawing canvas 600x400 */
             margin: 0 auto;
             display: flex;
@@ -428,11 +446,8 @@
 
         .svg-container svg {
             display: block;
-            max-width: 100%;
-            max-height: 100%;
-            width: auto;
-            height: auto;
-            object-fit: contain;
+            width: 100%;
+            height: 100%;
         }
 
         .svg-path {
@@ -523,12 +538,44 @@
 
                 <!-- Drawing Section -->
                 <div class="drawing-section active" id="drawingSection">
-                    <div class="canvas-container" style="position: relative;">
-                        <div style="position: absolute; top: 12px; right: 12px; display: flex; gap: 8px; z-index: 10;">
-                            <button id="undoBtn" style="background: rgba(255, 255, 255, 0.95); border: none; padding: 8px 16px; cursor: pointer; font-size: 13px; font-weight: 600; color: #6366f1; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); transition: all 0.2s; backdrop-filter: blur(8px);" onmouseover="this.style.background='rgba(255, 255, 255, 1)'; this.style.boxShadow='0 4px 12px rgba(99, 102, 241, 0.2)'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.95)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.1)'; this.style.transform='translateY(0)'">Undo</button>
-                            <button id="clearBtn" style="background: rgba(255, 255, 255, 0.95); border: none; padding: 8px 16px; cursor: pointer; font-size: 13px; font-weight: 600; color: #ef4444; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); transition: all 0.2s; backdrop-filter: blur(8px);" onmouseover="this.style.background='rgba(255, 255, 255, 1)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.2)'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.95)'; this.style.boxShadow='0 2px 8px rgba(0, 0, 0, 0.1)'; this.style.transform='translateY(0)'">Clear</button>
+                    <!-- Guide Image Control -->
+                    <div style="margin-bottom: 12px; position: relative;">
+                        <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f9fafb; border-radius: 8px; cursor: pointer; width: fit-content;" id="guideImageToggle">
+                            <input type="checkbox" id="guideImageCheckbox" style="width: 18px; height: 18px; cursor: pointer; accent-color: #818cf8;">
+                            <span style="font-size: 12px; font-weight: 600; color: #374151;">Guide Image</span>
+                        </div>
+                        <!-- Guide image settings popup -->
+                        <div id="guideImagePopup" style="display: none; position: absolute; top: 100%; left: 0; margin-top: 8px; background: white; border-radius: 12px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); width: 280px; z-index: 1000;">
+                            <div style="margin-bottom: 12px;">
+                                <label style="display: block; font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 6px;">
+                                    Opacity: <span id="guideOpacityDisplay" style="color: #818cf8;">30%</span>
+                                </label>
+                                <input type="range" id="guideOpacity" min="10" max="100" step="5" value="30" style="width: 100%; height: 4px; border-radius: 2px; background: #e0e7ff; outline: none; -webkit-appearance: none; cursor: pointer;">
+                            </div>
+                            <div>
+                                <label style="display: block; font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 6px;">Upload Guide Image</label>
+                                <div style="border: 2px dashed #c7d2fe; border-radius: 8px; padding: 16px; text-align: center; background: #faf5ff; cursor: pointer; position: relative; min-height: 80px; display: flex; align-items: center; justify-content: center;" id="guideUploadArea">
+                                    <input type="file" id="guideImageUpload" accept="image/*" style="display: none;">
+                                    <div id="guideUploadPlaceholder" style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
+                                        <span style="font-size: 11px; color: #6366f1;">üñºÔ∏è Click to upload</span>
+                                    </div>
+                                    <div id="guideImagePreview" style="display: none; flex-direction: column; align-items: center; gap: 8px;">
+                                        <img id="guidePreviewImg" style="max-width: 60px; max-height: 60px; object-fit: contain;" />
+                                        <span style="font-size: 10px; color: #6b7280;" id="guideImageName"></span>
+                                        <span style="font-size: 9px; color: #818cf8; cursor: pointer;" id="changeGuideImage">Change image</span>
+                                    </div>
+                                </div>
+                            </div>
                         </div>
-                        <canvas id="drawingCanvas" width="600" height="400"></canvas>
+                    </div>
+
+                    <div class="canvas-container" style="position: relative;">
+                        <canvas id="guideCanvas" width="600" height="400" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0.3; display: none; z-index: 1;"></canvas>
+                        <canvas id="drawingCanvas" width="600" height="400" style="z-index: 2;"></canvas>
+                    </div>
+                    <div style="display: flex; justify-content: flex-start; margin-top: 16px; gap: 8px;">
+                        <button id="undoBtn" class="btn-primary" style="padding: 8px 16px; font-size: 12px;">Undo</button>
+                        <button id="clearBtn" class="btn-primary" style="padding: 8px 16px; font-size: 12px; background: #a78bfa;">Clear</button>
                     </div>
                 </div>
 
@@ -565,18 +612,22 @@
                             <input type="range" id="duration" min="0.5" max="10" step="0.1" value="3" style="width: 100px; height: 4px; border-radius: 2px; background: #e0e7ff; outline: none; -webkit-appearance: none; cursor: pointer;">
                             <span class="value-display" id="durationDisplay" style="min-width: 45px;">3.0s</span>
                         </div>
-                        <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f9fafb; border-radius: 8px;" id="drawStrokeWidthContainer">
-                            <span style="font-size: 12px; font-weight: 600; color: #374151;">Stroke Width:</span>
-                            <input type="range" id="drawStrokeWidth" min="1" max="20" step="1" value="3" style="width: 80px; height: 4px; border-radius: 2px; background: #e0e7ff; outline: none; -webkit-appearance: none; cursor: pointer;">
-                            <span class="value-display" id="drawStrokeWidthDisplay" style="min-width: 35px;">3px</span>
-                        </div>
                         <div style="position: relative;">
                             <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f9fafb; border-radius: 8px; cursor: pointer;" id="strokeColorIndicator">
                                 <span style="font-size: 12px; font-weight: 600; color: #374151;">Stroke:</span>
                                 <div id="strokeColorPreview" style="width: 24px; height: 24px; border-radius: 4px; background: #000000; border: 2px solid #e5e7eb;"></div>
+                                <span style="font-size: 12px; font-weight: 600; color: #374151;" id="strokeWidthPreview">3px</span>
                             </div>
                             <!-- Stroke color popup -->
                             <div id="strokeColorPopup" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 8px; background: white; border-radius: 12px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); width: 280px; z-index: 1000;">
+                                <!-- Stroke width slider (for draw mode) -->
+                                <div id="drawStrokeWidthSection" style="margin-bottom: 16px;">
+                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
+                                        <span style="font-size: 12px; font-weight: 600; color: #374151;">Stroke Width</span>
+                                        <span class="value-display" id="popupStrokeWidthDisplay" style="font-size: 12px; font-weight: 600; color: #ffffff;">3px</span>
+                                    </div>
+                                    <input type="range" id="popupStrokeWidth" min="1" max="20" step="1" value="3" style="width: 100%; height: 6px; border-radius: 3px; background: #e0e7ff; outline: none; -webkit-appearance: none; cursor: pointer;">
+                                </div>
                                 <!-- Color square picker -->
                                 <div style="position: relative; width: 100%; height: 150px; background: linear-gradient(to right, white, red); border-radius: 8px; margin-bottom: 12px; cursor: crosshair; border: 2px solid #e5e7eb;" id="strokeColorSquare">
                                     <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to bottom, transparent, black); border-radius: 6px;" id="strokeColorOverlay"></div>
@@ -591,11 +642,29 @@
                                 </div>
                                 
                                 <!-- Hex input -->
-                                <div style="display: flex; align-items: center; gap: 8px;">
+                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                                     <span style="font-size: 12px; font-weight: 600; color: #374151;">Hex:</span>
                                     <input type="text" id="strokeColorHexInput" value="#000000" style="flex: 1; padding: 6px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-family: monospace; font-size: 13px;">
                                     <input type="color" id="strokeColor" value="#000000" style="width: 40px; height: 32px; border: 2px solid #e5e7eb; border-radius: 6px; cursor: pointer;">
                                 </div>
+
+                                <!-- Divider -->
+                                <div style="border-top: 1px solid #e5e7eb; margin-bottom: 16px;" id="uploadStrokeDivider"></div>
+
+                                <!-- Consistent Stroke Width (for upload mode) -->
+                                <div id="uploadStrokeSection" style="display: none;">
+                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
+                                        <input type="checkbox" id="uploadStrokeCheckbox" style="width: 18px; height: 18px; cursor: pointer; accent-color: #818cf8;">
+                                        <span style="font-size: 12px; font-weight: 600; color: #374151;">Consistent Stroke Width</span>
+                                    </div>
+                                    <div id="uploadStrokeWidthControl" style="display: none;">
+                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
+                                            <span style="font-size: 12px; font-weight: 600; color: #374151;">Stroke Width</span>
+                                            <span class="value-display" id="uploadStrokeWidthDisplay" style="font-size: 12px; font-weight: 600; color: #ffffff;">3px</span>
+                                        </div>
+                                        <input type="range" id="uploadStrokeWidth" min="0.5" max="20" step="0.5" value="3" style="width: 100%; height: 6px; border-radius: 3px; background: #e0e7ff; outline: none; -webkit-appearance: none; cursor: pointer;">
+                                    </div>
+                                </div>
                             </div>
                         </div>
                         <div style="position: relative;">
@@ -635,9 +704,9 @@
                             <div id="handSettingsPopup" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 8px; background: white; border-radius: 12px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); width: 280px; z-index: 1000;">
                                 <div style="margin-bottom: 12px;">
                                     <label style="display: block; font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 6px;">
-                                        Size: <span id="handSizeDisplay" style="color: #818cf8;">50px</span>
+                                        Size: <span id="handSizeDisplay" style="color: #818cf8;">180px</span>
                                     </label>
-                                    <input type="range" id="handSize" min="20" max="200" step="5" value="50" style="width: 100%; height: 4px; border-radius: 2px; background: #e0e7ff; outline: none; -webkit-appearance: none; cursor: pointer;">
+                                    <input type="range" id="handSize" min="50" max="300" step="5" value="180" style="width: 100%; height: 4px; border-radius: 2px; background: #e0e7ff; outline: none; -webkit-appearance: none; cursor: pointer;">
                                 </div>
                                 <div>
                                     <label style="display: block; font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 6px;">Choose Hand</label>
@@ -682,21 +751,6 @@
                                 </div>
                             </div>
                         </div>
-                        <div style="position: relative;">
-                            <div style="display: none; align-items: center; gap: 8px; padding: 8px 12px; background: #f9fafb; border-radius: 8px; cursor: pointer;" id="uploadStrokeToggle">
-                                <input type="checkbox" id="uploadStrokeCheckbox" style="width: 18px; height: 18px; cursor: pointer; accent-color: #818cf8;">
-                                <span style="font-size: 12px; font-weight: 600; color: #374151;">Consistent Stroke Width</span>
-                            </div>
-                            <!-- Manual stroke settings popup -->
-                            <div id="uploadStrokePopup" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 8px; background: white; border-radius: 12px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); width: 220px; z-index: 1000;">
-                                <div>
-                                    <label style="display: block; font-size: 12px; font-weight: 600; color: #374151; margin-bottom: 6px;">
-                                        Stroke Width: <span id="uploadStrokeWidthDisplay" style="color: #818cf8;">3px</span>
-                                    </label>
-                                    <input type="range" id="uploadStrokeWidth" min="0.5" max="20" step="0.5" value="3" style="width: 100%; height: 4px; border-radius: 2px; background: #e0e7ff; outline: none; -webkit-appearance: none; cursor: pointer;">
-                                </div>
-                            </div>
-                        </div>
                         <button class="btn-primary" id="animateBtn" disabled style="padding: 10px 20px; font-size: 13px; margin-left: 8px;">‚ñ∂ Animate</button>
                     </div>
                 </div>
@@ -712,9 +766,9 @@
                         </div>
                     </div>
                 </div>
-                <div style="display: flex; justify-content: center; margin-top: 16px;">
+                <div style="display: flex; justify-content: flex-start; margin-top: 16px;">
                     <button id="downloadGifBtn" class="btn-primary" style="display: none; padding: 8px 16px; font-size: 12px;">
-                        ‚¨á Download as GIF
+                        Download GIF
                     </button>
                 </div>
             </div>
@@ -746,11 +800,22 @@
             drawingSection.classList.add('active');
             uploadSection.classList.remove('active');
             
-            // Show draw stroke width, hide upload manual stroke
-            const drawStrokeWidthContainer = document.getElementById('drawStrokeWidthContainer');
-            const uploadStrokeToggle = document.getElementById('uploadStrokeToggle');
-            if (drawStrokeWidthContainer) drawStrokeWidthContainer.style.display = 'flex';
-            if (uploadStrokeToggle) uploadStrokeToggle.style.display = 'none';
+            // Show draw stroke width, hide upload stroke section in popup
+            const drawStrokeWidthSection = document.getElementById('drawStrokeWidthSection');
+            const uploadStrokeSection = document.getElementById('uploadStrokeSection');
+            const uploadStrokeDivider = document.getElementById('uploadStrokeDivider');
+            const strokeWidthPreview = document.getElementById('strokeWidthPreview');
+            const popupStrokeWidth = document.getElementById('popupStrokeWidth');
+
+            if (drawStrokeWidthSection) drawStrokeWidthSection.style.display = 'block';
+            if (uploadStrokeSection) uploadStrokeSection.style.display = 'none';
+            if (uploadStrokeDivider) uploadStrokeDivider.style.display = 'none';
+
+            // Show stroke width preview with draw mode value
+            if (strokeWidthPreview && popupStrokeWidth) {
+                strokeWidthPreview.style.display = 'inline';
+                strokeWidthPreview.textContent = popupStrokeWidth.value + 'px';
+            }
             
             // Clear uploaded content
             if (svgContainer) {
@@ -774,11 +839,21 @@
             uploadSection.classList.add('active');
             drawingSection.classList.remove('active');
             
-            // Hide draw stroke width, show upload manual stroke
-            const drawStrokeWidthContainer = document.getElementById('drawStrokeWidthContainer');
-            const uploadStrokeToggle = document.getElementById('uploadStrokeToggle');
-            if (drawStrokeWidthContainer) drawStrokeWidthContainer.style.display = 'none';
-            if (uploadStrokeToggle) uploadStrokeToggle.style.display = 'flex';
+            // Hide draw stroke width, show upload stroke section in popup
+            const drawStrokeWidthSection = document.getElementById('drawStrokeWidthSection');
+            const uploadStrokeSection = document.getElementById('uploadStrokeSection');
+            const uploadStrokeDivider = document.getElementById('uploadStrokeDivider');
+            const strokeWidthPreview = document.getElementById('strokeWidthPreview');
+            const uploadStrokeCheckbox = document.getElementById('uploadStrokeCheckbox');
+
+            if (drawStrokeWidthSection) drawStrokeWidthSection.style.display = 'none';
+            if (uploadStrokeSection) uploadStrokeSection.style.display = 'block';
+            if (uploadStrokeDivider) uploadStrokeDivider.style.display = 'block';
+
+            // Hide stroke width preview if checkbox is not checked
+            if (strokeWidthPreview && uploadStrokeCheckbox) {
+                strokeWidthPreview.style.display = uploadStrokeCheckbox.checked ? 'inline' : 'none';
+            }
             
             // Clear drawn content
             allStrokes = [];
@@ -786,8 +861,6 @@
             
             // Clear the canvas
             ctx.clearRect(0, 0, canvas.width, canvas.height);
-            ctx.fillStyle = 'white';
-            ctx.fillRect(0, 0, canvas.width, canvas.height);
             
             // Clear SVG container and show placeholder
             if (svgContainer) {
@@ -822,22 +895,23 @@
         let allStrokes = [];
         let strokeTimestamps = [];
 
-        // Set canvas background
-        ctx.fillStyle = 'white';
-        ctx.fillRect(0, 0, canvas.width, canvas.height);
+        // Canvas starts transparent (white background is from container::before)
         ctx.strokeStyle = '#000000';  // Always draw in black on canvas
         ctx.lineWidth = 3;
         ctx.lineCap = 'round';
         ctx.lineJoin = 'round';
 
-        // Draw stroke width control
-        const drawStrokeWidth = document.getElementById('drawStrokeWidth');
-        const drawStrokeWidthDisplay = document.getElementById('drawStrokeWidthDisplay');
-        if (drawStrokeWidth && drawStrokeWidthDisplay) {
-            drawStrokeWidth.addEventListener('input', (e) => {
+        // Popup stroke width control
+        const popupStrokeWidth = document.getElementById('popupStrokeWidth');
+        const popupStrokeWidthDisplay = document.getElementById('popupStrokeWidthDisplay');
+        const strokeWidthPreview = document.getElementById('strokeWidthPreview');
+
+        if (popupStrokeWidth && popupStrokeWidthDisplay && strokeWidthPreview) {
+            popupStrokeWidth.addEventListener('input', (e) => {
                 const width = parseInt(e.target.value);
-                // Don't change canvas line width - only affects animation
-                drawStrokeWidthDisplay.textContent = width + 'px';
+                // Update all displays
+                popupStrokeWidthDisplay.textContent = width + 'px';
+                strokeWidthPreview.textContent = width + 'px';
             });
         }
 
@@ -851,12 +925,10 @@
             strokeColorIndicator.addEventListener('click', (e) => {
                 e.stopPropagation();
                 const isVisible = strokeColorPopup.style.display === 'block';
+                if (!isVisible) {
+                    closeAllPopups();
+                }
                 strokeColorPopup.style.display = isVisible ? 'none' : 'block';
-                // Close other popups
-                const bgColorPopup = document.getElementById('bgColorPopup');
-                const handSettingsPopup = document.getElementById('handSettingsPopup');
-                if (bgColorPopup) bgColorPopup.style.display = 'none';
-                if (handSettingsPopup) handSettingsPopup.style.display = 'none';
             });
             
             // Custom color picker interaction for stroke
@@ -1043,10 +1115,9 @@
         // Clear button
         document.getElementById('clearBtn').addEventListener('click', () => {
             ctx.clearRect(0, 0, canvas.width, canvas.height);
-            ctx.fillStyle = 'white';
-            ctx.fillRect(0, 0, canvas.width, canvas.height);
             allStrokes = [];
-            
+            userSetDuration = false; // Reset duration flag for new drawing
+
             document.getElementById('animateBtn').disabled = true;
         });
 
@@ -1063,11 +1134,8 @@
 
         function redrawCanvas() {
             ctx.clearRect(0, 0, canvas.width, canvas.height);
-            
-            // Always use white background for drawing canvas
-            ctx.fillStyle = 'white';
-            ctx.fillRect(0, 0, canvas.width, canvas.height);
-            
+
+            // Canvas is transparent, white background comes from container
             // Always use black for canvas drawing
             ctx.strokeStyle = '#000000';
             
@@ -1106,9 +1174,15 @@
         
         // Update duration slider and display
         function setDuration(seconds) {
+            // Don't override if user has manually set duration
+            if (userSetDuration) {
+                console.log('User has set custom duration, skipping suggestion');
+                return;
+            }
+
             const durationSlider = document.getElementById('duration');
             const durationDisplay = document.getElementById('durationDisplay');
-            
+
             if (durationSlider) {
                 durationSlider.value = seconds;
             }
@@ -1123,9 +1197,9 @@
             const strokeColorValue = strokeColor.value;
             const bgColorValue = bgColor.value;
             
-            // Get current stroke width from slider for the animation
-            const drawStrokeWidth = document.getElementById('drawStrokeWidth');
-            const strokeWidth = drawStrokeWidth ? drawStrokeWidth.value : '3';
+            // Get current stroke width from popup slider for the animation
+            const popupStrokeWidth = document.getElementById('popupStrokeWidth');
+            const strokeWidth = popupStrokeWidth ? popupStrokeWidth.value : '3';
             
             console.log('Converting to SVG with stroke color:', strokeColorValue, 'width:', strokeWidth);
             
@@ -1139,12 +1213,12 @@
             // Convert each stroke to a path
             allStrokes.forEach((stroke, index) => {
                 if (stroke.length < 2) return;
-                
+
                 let d = `M ${stroke[0].x} ${stroke[0].y}`;
                 for (let i = 1; i < stroke.length; i++) {
                     d += ` L ${stroke[i].x} ${stroke[i].y}`;
                 }
-                
+
                 const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                 path.setAttribute('d', d);
                 path.setAttribute('class', 'svg-path');
@@ -1154,12 +1228,17 @@
                 path.setAttribute('stroke-linecap', 'round');
                 path.setAttribute('stroke-linejoin', 'round');
                 path.setAttribute('data-path', index);
-                
+
+                // Hide path initially for animation
+                const length = path.getTotalLength();
+                path.style.strokeDasharray = length;
+                path.style.strokeDashoffset = length;
+
                 if (index === 0) {
                     console.log('First path stroke-width attribute:', path.getAttribute('stroke-width'));
                     console.log('First path computed style:', window.getComputedStyle(path).strokeWidth);
                 }
-                
+
                 svg.appendChild(path);
             });
             
@@ -1191,6 +1270,7 @@
             const file = e.target.files[0];
             if (!file) return;
 
+            userSetDuration = false; // Reset duration flag for new upload
             document.getElementById('animateBtn').disabled = false;
             
             // Show preview of uploaded image
@@ -1784,14 +1864,29 @@
         const handSizeDisplay = document.getElementById('handSizeDisplay');
 
         let handImageData = null;
-        let handSizeValue = 50;
+        let handSizeValue = 180; // Default hand size matches slider default
         let handOffsetXPercent = 0;
         let handOffsetYPercent = 0;
+        let userSetDuration = false; // Track if user manually changed duration
 
         duration.addEventListener('input', (e) => {
             durationDisplay.textContent = parseFloat(e.target.value).toFixed(1) + 's';
+            userSetDuration = true; // User manually adjusted duration
         });
 
+        // Helper function to close all popups
+        function closeAllPopups() {
+            const popups = [
+                document.getElementById('handSettingsPopup'),
+                document.getElementById('guideImagePopup'),
+                document.getElementById('strokeColorPopup'),
+                document.getElementById('bgColorPopup')
+            ];
+            popups.forEach(popup => {
+                if (popup) popup.style.display = 'none';
+            });
+        }
+
         const handCheckbox = document.getElementById('handCheckbox');
         const handSettingsPopup = document.getElementById('handSettingsPopup');
         const handToggle = document.getElementById('handToggle');
@@ -1808,16 +1903,13 @@
             handToggle.addEventListener('click', (e) => {
                 // If clicking the checkbox itself, don't toggle the popup
                 if (e.target === handCheckbox) return;
-                
+
                 e.stopPropagation();
                 const isVisible = handSettingsPopup.style.display === 'block';
+                if (!isVisible) {
+                    closeAllPopups();
+                }
                 handSettingsPopup.style.display = isVisible ? 'none' : 'block';
-                
-                // Close other popups
-                const strokeColorPopup = document.getElementById('strokeColorPopup');
-                const bgColorPopup = document.getElementById('bgColorPopup');
-                if (strokeColorPopup) strokeColorPopup.style.display = 'none';
-                if (bgColorPopup) bgColorPopup.style.display = 'none';
             });
             
             // Prevent checkbox clicks from bubbling to handToggle
@@ -1825,9 +1917,13 @@
                 e.stopPropagation();
             });
             
-            // Checkbox change only affects whether hand is enabled, not popup visibility
+            // Checkbox change - show popup when checked, close when unchecked
             handCheckbox.addEventListener('change', (e) => {
-                if (!e.target.checked) {
+                if (e.target.checked && handSettingsPopup) {
+                    closeAllPopups();
+                    handSettingsPopup.style.display = 'block';
+                } else {
+                    handSettingsPopup.style.display = 'none';
                     handImageData = null; // Disable hand when unchecked
                 }
             });
@@ -1879,6 +1975,138 @@
             });
         }
 
+        // Guide image controls
+        const guideImageToggle = document.getElementById('guideImageToggle');
+        const guideImagePopup = document.getElementById('guideImagePopup');
+        const guideImageCheckbox = document.getElementById('guideImageCheckbox');
+        const guideImageUpload = document.getElementById('guideImageUpload');
+        const guideCanvas = document.getElementById('guideCanvas');
+        const guideOpacity = document.getElementById('guideOpacity');
+        const guideOpacityDisplay = document.getElementById('guideOpacityDisplay');
+        const guideUploadArea = document.getElementById('guideUploadArea');
+        const guideUploadPlaceholder = document.getElementById('guideUploadPlaceholder');
+        const guideImagePreview = document.getElementById('guideImagePreview');
+        const guidePreviewImg = document.getElementById('guidePreviewImg');
+        const guideImageName = document.getElementById('guideImageName');
+        const changeGuideImage = document.getElementById('changeGuideImage');
+
+        let guideImageData = null;
+
+        if (guideImageToggle && guideImagePopup && guideImageCheckbox) {
+            // Toggle popup on click
+            guideImageToggle.addEventListener('click', (e) => {
+                if (e.target !== guideImageCheckbox) {
+                    const isVisible = guideImagePopup.style.display === 'block';
+                    if (!isVisible) {
+                        closeAllPopups();
+                    }
+                    guideImagePopup.style.display = isVisible ? 'none' : 'block';
+                }
+            });
+
+            // Close popup when clicking outside
+            document.addEventListener('click', (e) => {
+                if (guideImagePopup && guideImageToggle && !guideImageToggle.contains(e.target) && !guideImagePopup.contains(e.target)) {
+                    guideImagePopup.style.display = 'none';
+                }
+            });
+
+            // Toggle guide canvas visibility and show popup when checked
+            guideImageCheckbox.addEventListener('change', (e) => {
+                if (guideCanvas) {
+                    guideCanvas.style.display = e.target.checked && guideImageData ? 'block' : 'none';
+                }
+                // Open popup when checked, close when unchecked
+                if (e.target.checked && guideImagePopup) {
+                    closeAllPopups();
+                    guideImagePopup.style.display = 'block';
+                } else if (guideImagePopup) {
+                    guideImagePopup.style.display = 'none';
+                }
+            });
+        }
+
+        // Opacity slider
+        if (guideOpacity && guideOpacityDisplay) {
+            guideOpacity.addEventListener('input', (e) => {
+                const opacity = parseInt(e.target.value);
+                guideOpacityDisplay.textContent = opacity + '%';
+                if (guideCanvas) {
+                    guideCanvas.style.opacity = opacity / 100;
+                }
+            });
+        }
+
+        // Upload area click handler
+        if (guideUploadArea && guideImageUpload) {
+            guideUploadArea.addEventListener('click', () => {
+                guideImageUpload.click();
+            });
+
+            if (changeGuideImage) {
+                changeGuideImage.addEventListener('click', (e) => {
+                    e.stopPropagation();
+                    guideImageUpload.click();
+                });
+            }
+        }
+
+        // Handle guide image upload
+        if (guideImageUpload && guideImageCheckbox) {
+            guideImageUpload.addEventListener('change', (e) => {
+                const file = e.target.files[0];
+                if (!file) return;
+
+                const reader = new FileReader();
+                reader.onload = (event) => {
+                    guideImageData = event.target.result;
+
+                    // Draw image on guide canvas
+                    const img = new Image();
+                    img.onload = () => {
+                        const canvasWidth = 600;
+                        const canvasHeight = 400;
+
+                        // Calculate scaling to fit image into canvas while maintaining aspect ratio
+                        const scaleX = canvasWidth / img.width;
+                        const scaleY = canvasHeight / img.height;
+                        const scale = Math.min(scaleX, scaleY);
+
+                        const scaledWidth = img.width * scale;
+                        const scaledHeight = img.height * scale;
+
+                        // Center the image
+                        const offsetX = (canvasWidth - scaledWidth) / 2;
+                        const offsetY = (canvasHeight - scaledHeight) / 2;
+
+                        // Draw guide image centered and scaled to fit
+                        const guideCtx = guideCanvas.getContext('2d');
+                        guideCtx.clearRect(0, 0, guideCanvas.width, guideCanvas.height);
+                        guideCtx.drawImage(img, offsetX, offsetY, scaledWidth, scaledHeight);
+
+                        // Show guide canvas if checkbox is checked
+                        if (guideImageCheckbox.checked) {
+                            guideCanvas.style.display = 'block';
+                        }
+                    };
+                    img.src = guideImageData;
+
+                    // Show preview in popup
+                    if (guidePreviewImg && guideImagePreview && guideUploadPlaceholder && guideImageName) {
+                        guidePreviewImg.src = guideImageData;
+                        guideImageName.textContent = file.name;
+                        guideUploadPlaceholder.style.display = 'none';
+                        guideImagePreview.style.display = 'flex';
+                    }
+
+                    // Auto-check the checkbox when image is uploaded
+                    guideImageCheckbox.checked = true;
+                    guideCanvas.style.display = 'block';
+                };
+                reader.readAsDataURL(file);
+            });
+        }
+
         // Pre-loaded hand selection
         const preloadedHands = document.querySelectorAll('.preloaded-hand');
         console.log('Found preloaded hands:', preloadedHands.length);
@@ -1902,6 +2130,41 @@
                 handImage.src = handSrc;
                 console.log('Pre-loaded hand selected:', handSrc);
 
+                // For hand3, calculate the leftmost non-transparent pixel as pen tip
+                if (handSrc === 'hand3.png') {
+                    const img = new Image();
+                    img.onload = () => {
+                        const canvas = document.createElement('canvas');
+                        canvas.width = img.width;
+                        canvas.height = img.height;
+                        const ctx = canvas.getContext('2d');
+                        ctx.drawImage(img, 0, 0);
+                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
+                        const pixels = imageData.data;
+
+                        // Find leftmost non-transparent pixel
+                        let leftmostX = canvas.width;
+                        let leftmostY = 0;
+
+                        for (let y = 0; y < canvas.height; y++) {
+                            for (let x = 0; x < canvas.width; x++) {
+                                const alpha = pixels[(y * canvas.width + x) * 4 + 3];
+                                if (alpha > 0 && x < leftmostX) {
+                                    leftmostX = x;
+                                    leftmostY = y;
+                                }
+                            }
+                        }
+
+                        // Calculate offset as percentage
+                        handOffsetXPercent = (leftmostX / canvas.width) * 100;
+                        handOffsetYPercent = (leftmostY / canvas.height) * 100;
+                        console.log('Hand3 pen tip offset:', handOffsetXPercent, handOffsetYPercent);
+                    };
+                    img.src = handSrc;
+                }
+                // Note: Other hands keep their existing offset values (default 0,0)
+
                 // Convert to data URL using fetch (works better with same-origin)
                 fetch(handSrc)
                     .then(response => response.blob())
@@ -1950,34 +2213,36 @@
         });
 
         // Upload manual stroke width controls
-        const uploadStrokeToggle = document.getElementById('uploadStrokeToggle');
-        const uploadStrokePopup = document.getElementById('uploadStrokePopup');
         const uploadStrokeCheckbox = document.getElementById('uploadStrokeCheckbox');
         const uploadStrokeWidth = document.getElementById('uploadStrokeWidth');
         const uploadStrokeWidthDisplay = document.getElementById('uploadStrokeWidthDisplay');
-        
-        if (uploadStrokeToggle && uploadStrokePopup && uploadStrokeCheckbox) {
-            // Toggle popup on click
-            uploadStrokeToggle.addEventListener('click', (e) => {
-                if (e.target !== uploadStrokeCheckbox) {
-                    const isVisible = uploadStrokePopup.style.display === 'block';
-                    uploadStrokePopup.style.display = isVisible ? 'none' : 'block';
-                }
-            });
-            
-            // Close popup when clicking outside
-            document.addEventListener('click', (e) => {
-                if (uploadStrokePopup && uploadStrokeToggle && !uploadStrokeToggle.contains(e.target) && !uploadStrokePopup.contains(e.target)) {
-                    uploadStrokePopup.style.display = 'none';
+        const uploadStrokeWidthControl = document.getElementById('uploadStrokeWidthControl');
+
+        // Show/hide stroke width slider and preview when checkbox is toggled
+        if (uploadStrokeCheckbox && uploadStrokeWidthControl) {
+            uploadStrokeCheckbox.addEventListener('change', (e) => {
+                uploadStrokeWidthControl.style.display = e.target.checked ? 'block' : 'none';
+                // Update the stroke width preview indicator
+                if (strokeWidthPreview) {
+                    if (e.target.checked) {
+                        strokeWidthPreview.textContent = uploadStrokeWidth.value + 'px';
+                        strokeWidthPreview.style.display = 'inline';
+                    } else {
+                        strokeWidthPreview.style.display = 'none';
+                    }
                 }
             });
         }
-        
-        // Update stroke width display
+
+        // Update stroke width display and preview
         if (uploadStrokeWidth && uploadStrokeWidthDisplay) {
             uploadStrokeWidth.addEventListener('input', (e) => {
                 const width = parseFloat(e.target.value);
                 uploadStrokeWidthDisplay.textContent = width + 'px';
+                // Also update the preview indicator
+                if (strokeWidthPreview && uploadStrokeCheckbox && uploadStrokeCheckbox.checked) {
+                    strokeWidthPreview.textContent = width + 'px';
+                }
             });
         }
 
@@ -2168,20 +2433,21 @@
         function animatePaths() {
             const paths = svgContainer.querySelectorAll('.svg-path');
             const animDuration = parseFloat(duration.value);
-            
+
             // Reset all paths before animating
             paths.forEach(path => {
+                const length = path.getTotalLength();
                 path.style.transition = 'none';
-                path.style.strokeDasharray = '';
-                path.style.strokeDashoffset = '';
+                path.style.strokeDasharray = length;
+                path.style.strokeDashoffset = length; // Hide paths initially
             });
-            
+
             // Force reflow to apply the reset
             void svgContainer.offsetWidth;
-            
+
             // Check if we're animating user-drawn content
             const isUserDrawing = window.userDrawingData && window.userDrawingData.length > 0;
-            
+
             if (isUserDrawing) {
                 animateUserDrawing(animDuration);
             } else {
@@ -2621,7 +2887,7 @@
                     await captureAnimationAsGif();
                     downloadGifBtn.textContent = '‚úì GIF Downloaded!';
                     setTimeout(() => {
-                        downloadGifBtn.textContent = '‚¨á Download as GIF';
+                        downloadGifBtn.textContent = 'Download GIF';
                         downloadGifBtn.disabled = false;
                     }, 2000);
                 } catch (error) {
@@ -2629,7 +2895,7 @@
                     console.error('Error stack:', error.stack);
                     downloadGifBtn.textContent = '‚úó ' + (error.message || 'Error creating GIF');
                     setTimeout(() => {
-                        downloadGifBtn.textContent = '‚¨á Download as GIF';
+                        downloadGifBtn.textContent = 'Download GIF';
                         downloadGifBtn.disabled = false;
                     }, 3000);
                 }
